services:
  # discovery:
  #   image: yuri000/squad13:discovery
  #   # build:
  #   #   context: ..
  #   #   dockerfile: docker/dockerfiles/jdk21-distroless-gradle/Dockerfile
  #   #   args:
  #   #     SERVICE_NAME: discovery
  #   ports:
  #     - "12999:12999"
  #   environment:
  #     - SERVER_PORT=12999
  #     - EUREKA_HOSTNAME=discovery

  # gateway:
  #   image: yuri000/squad13:gateway
  #   # build:
  #   #   context: ..
  #   #   dockerfile: docker/dockerfiles/jdk21-distroless-gradle/Dockerfile
  #   #   args:
  #   #     SERVICE_NAME: gateway
  #   ports:
  #     - "13000:13000"
  #   environment:
  #     - SERVER_PORT=13000
  #     - EUREKA_HOST=http://discovery:12999/eureka/
  #   # - CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:5173 | NÃ£o testado
  #   depends_on:
  #     - discovery

#  client:
#    build:
#      context: ..
#      dockerfile: docker/dockerfiles/react_vite_client/Dockerfile
#      args:
#        CLIENT_PATH: /front/FrontEnd-JotaNunes
#    ports:
#      - "13999:80"
#    volumes:
#      - ./logs/nginx-logs:/var/log/nginx

  monolito_db:
    image: postgres:16
    container_name: monolito_db
    restart: always
    environment:
      POSTGRES_DB: monolito
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      PGDATA: /var/lib/postgresql/data/pgdata
    ports:
      - "5432:5432"
    volumes:
      - pg_data:/var/lib/postgresql/data

  # rabbitmq:
  #   image: rabbitmq:latest
  #   ports:
  #     - "5672:5672"
  #     - "15672:15672"
  #   environment:
  #     RABBITMQ_DEFAULT_USER: admin
  #     RABBITMQ_DEFAULT_PASS: admin
  #   volumes:
  #     - rabbitmq_data:/var/lib/rabbitmq

  prometheus:
    image: prom/prometheus
    container_name: prometheus
    volumes:
      - ./prometheus:/etc/prometheus:ro
    ports:
      - "9090:9090"
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
    depends_on:
      - monolito_db

  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
    depends_on:
      - prometheus
  
  postgres_exporter:
    image: prometheuscommunity/postgres-exporter
    container_name: postgres_exporter
    environment:
      DATA_SOURCE_NAME: "postgresql://neondb_owner:npg_Nho4eqVgl3YE@ep-gentle-voice-acviag1c-pooler.sa-east-1.aws.neon.tech:5432/neondb?sslmode=require"
    ports:
      - "9187:9187"
    depends_on:
      - grafana

volumes:
  pg_data:
  grafana_data:
  # rabbitmq_data:
